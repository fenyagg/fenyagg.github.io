<<<<<<< HEAD
!function(e){"use strict";function r(e){return e.replace(/\(|\)|\s+|-/g,"")}Object.create||(Object.create=function(e){function r(){}return r.prototype=e,new r});var t={required:"This Field is required.",email:"Please enter a valid email address.",url:"Please enter a valid URL.",date:"Please enter a valid date.",number:"Please enter a number.",confirm_password:"Passwords do not match.",maxlength:"Please enter no more than {0} characters.",minlength:"Please enter at least {0} characters.",rangelength:"Please enter a value between {0} to {1} characters.",range:"Please enter a number between {0} to {1}.",max:"Please enter a number less than or equal to {0}.",min:"Please enter a number greater than or equal to {0}.",phone_all:"Please enter a valid phone number.",phone:"Please enter a valid phone number.",inn:"Please enter a valid INN.",inn_u:"Please enter a valid INN of a legal entity.",inn_f:"Please enter a valid INN of a natural person.",ogrn:"Please enter a valid OGRN.",kpp:"Please enter a valid KPP.",filetype:"Invalid file type. Possible types: {0}.",group:"Please fill in the {0}.",list_separator:" or ",ruleGroup:"Wrong format"},a={ruleGroup:function(r,t){var a,i=this,n=!1;if(e.isArray(r.params.ruleGroup)&&r.params.ruleGroup.length){a=r.params.ruleGroup.length;var l=function(){var e=n?"":i.getMessage.call(r,"ruleGroup");t(r,e)};r.params.ruleGroup.forEach(function(t){var s=i.getRule(t);return s&&e.isFunction(s)?void s.call(i,r,function(e,r){r||(n=!0),--a||l()}):(console.error("citrusValidator: Нет правила '"+t+"'"),--a||l(),!0)})}},file:function(e,r){var t=e.$el;if(!t.val())return r(e),!0;for(var a=!0,i=0;i<t.get(0).files.length;i++){var n=t[0].files[i];if("name"in n){var l=n.name.split(".");l=l[l.length-1].toLocaleLowerCase(),e.params.filetype.indexOf(l)+1||(a=!1)}}var s=a?"":this.getMessage.call(e,"filetype",[e.params.filetype]);r(e,s)},required:function(r,t){var a=r.$el.get(0),i="radio"===a.type||"checkbox"===a.type?this.$form.find('[name="'+a.name+'"]:checked').length:""!==e.trim(a.value),n=i?"":this.getMessage.call(r,"required");t(r,n)},important:function(e,r){r(e)},phone_all:function(e,t){var a=e.$el;if(!a.val())return t(e),!0;var i=r(a.val()),n=i.length>5&&/^((8|\+7)[\- ]?)?(\(?\d{3}\)?[\- ]?)?[\d\- ]{6,10}$/.test(i),l=n?"":this.getMessage.call(e,"phone_all");t(e,l)},phone:function(e,t){var a=e.$el;if(!a.val())return t(e),!0;var i=r(a.val()),n=i.length>10&&/^(8|\+7){1}(\d{10})$/.test(i),l=n?"":this.getMessage.call(e,"phone");t(e,l)},ajax:function(r,t){var a=this,i=r.$el;if(!i.val())return t(r),!0;a.callEvent("lockField",i);var n=r.params.ajaxUrl;n.length>0&&e.ajax({url:n,type:"POST",dataType:"html",data:{name:i.attr("name"),value:i.val()}}).done(function(e){return e.length>0?void t(r,e):void t(r)}).fail(function(){console.error("citrusValidator: ajax validate error"),t(r)}).always(function(){a.callEvent("unlockField",i)})},email:function(r,t){var a=r.$el;if(!a.val())return t(r),!0;var i=e.trim(a.val()),n=/^(|(([A-Za-z0-9]+_+)|([A-Za-z0-9]+\-+)|([A-Za-z0-9]+\.+)|([A-Za-z0-9]+\++))*[A-Za-z0-9]+@((\w+\-+)|(\w+\.))*\w{1,63}\.[a-zA-Z]{2,6})$/.test(i),l=n?"":this.getMessage.call(r,"email");t(r,l)},number:function(e,r){var t=e.$el;if(!t.val())return r(e),!0;var a=/^(?:-?\d+|-?\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/.test(t.val());if(!a)return void r(e,this.getMessage.call(e,"number"));var i,n,l=+t.val(),s="",o=!1,u=!1;"undefined"!=typeof e.params.min&&""!==e.params.min&&(i=+e.params.min,o=!0),"undefined"!=typeof e.params.max&&""!==e.params.max&&(n=+e.params.max,u=!0),o&&u?(l<i||l>n)&&(s=this.getMessage.call(e,"range",[i,n])):(o&&l<i&&(s=this.getMessage.call(e,"min",[i])),u&&l>n&&(s=this.getMessage.call(e,"max",[n]))),r(e,s)},length:function(e,r){var t=e.$el,a=e.params.minlength,i=e.params.maxlength,n=t.val().length,l=!1;"undefined"!=typeof a&&"undefined"!=typeof i?(n>i||n<a)&&(l=this.getMessage.call(e,"rangelength",[a,i])):"undefined"!=typeof a?n<a&&(l=this.getMessage.call(e,"minlength",[a])):"undefined"!=typeof i&&n>i&&(l=this.getMessage.call(e,"maxlength",[i])),r(e,l)},main_password:function(r,t){var a=r.$el,i=this.filterField(function(r){return e.inArray("confirm_password",r.arRules)+1})[0];i.$el.val()&&a.val()&&this.validateField(i),t(r)},confirm_password:function(e,r){var t=e.$el;if(!t.val())return r(e),!0;var a=t.parents("form").find("[data-valid*='main_password']"),i=t.val()===a.val(),n=i?"":this.getMessage.call(e,"confirm_password");r(e,n)},url:function(e,r){var t=e.$el;if(!t.val())return r(e),!0;var a=/^(?:(?:(?:https?|ftp):)?\/\/)(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})).?)(?::\d{2,5})?(?:[\/?#]\S*)?$/i.test(t.val()),i=a?"":this.getMessage.call(e,"url");r(e,i)},inn:function(e,r){var t=e.$el;if(!t.val())return r(e),!0;var a=t.val(),i=!0;if(a.match(/\D/))i=!1;else{if(12!=a.length&&10!=a.length&&(i=!1),10==a.length){var n=String((2*a[0]+4*a[1]+10*a[2]+3*a[3]+5*a[4]+9*a[5]+4*a[6]+6*a[7]+8*a[8])%11%10);i=a[9]==n}if(12==a.length){var l=String((7*a[0]+2*a[1]+4*a[2]+10*a[3]+3*a[4]+5*a[5]+9*a[6]+4*a[7]+6*a[8]+8*a[9])%11%10),s=String((3*a[0]+7*a[1]+2*a[2]+4*a[3]+10*a[4]+3*a[5]+5*a[6]+9*a[7]+4*a[8]+6*a[9]+8*a[10])%11%10);i=a[10]==l&&a[11]==s}}var o=i?"":this.getMessage.call(e,"inn");r(e,o)},inn_u:function(e,r){var t=e.$el;if(!t.val())return r(e),!0;var a=t.val(),i=!0;a.match(/\D/)&&(i=!1),10!=a.length&&(i=!1);var n=String((2*a[0]+4*a[1]+10*a[2]+3*a[3]+5*a[4]+9*a[5]+4*a[6]+6*a[7]+8*a[8])%11%10);i=a[9]==n;var l=i?"":this.getMessage.call(e,"inn_u");r(e,l)},inn_f:function(e,r){var t=e.$el;if(!t.val())return r(e),!0;var a=t.val(),i=!0;a.match(/\D/)&&(i=!1),i=12==a.length&&a[10]==(7*a[0]+2*a[1]+4*a[2]+10*a[3]+3*a[4]+5*a[5]+9*a[6]+4*a[7]+6*a[8]+8*a[9])%11%10&&a[11]==(3*a[0]+7*a[1]+2*a[2]+4*a[3]+10*a[4]+3*a[5]+5*a[6]+9*a[7]+4*a[8]+6*a[9]+8*a[10])%11%10;var n=i?"":this.getMessage.call(e,"inn_f");r(e,n)},ogrn:function(e,r){var t=e.$el;if(!t.val())return r(e),!0;var a=t.val(),i=!0;i=13==a.length&&a.slice(-1)==(a.slice(0,-1)%11+"").slice(-1)||15==a.length&&a.slice(-1)==(a.slice(0,-1)%13+"").slice(-1);var n=i?"":this.getMessage.call(e,"ogrn");r(e,n)},kpp:function(e,r){var t=e.$el;if(!t.val())return r(e),!0;var a=t.val(),i=!0;a.match(/\D/)&&(i=!1),a.match(/([0-9]{1}[1-9]{1}|[1-9]{1}[0-9]{1})([0-9]{2})([0-9A-F]{2})([0-9]{3})/)||(i=!1);var n=i?"":this.getMessage.call(e,"kpp");r(e,n)}},i={addFieldError:function(e,r){var t=e.parents(this.settings.input_container);t.addClass("has-error").removeClass("has-success");var a=r.join("<br>"),i=t.find(".error.help-block");i.length>0?i.html(a):t.append('<div class="error help-block">'+a+"</div>")},removeFieldError:function(e){e.parents(this.settings.input_container).removeClass("has-error").addClass("has-success")},addGroupError:function(e,r){if(e){var t=this;r.forEach(function(r){var a=r.$el.parents(t.settings.input_container);a.addClass("has-group-error").removeClass("has-group-success");var i=a.find(".group-error.help-block"),n=t.requireGroup[e].error;i.length>0?i.html(n):a.append('<div class="group-error help-block">'+n+"</div>")})}},removeGroupError:function(e,r){if(e){var t=this;r.forEach(function(e){var r=e.$el.parents(t.settings.input_container);r.addClass("has-group-success").removeClass("has-group-error")})}},clearField:function(e){e.parents(this.settings.input_container).removeClass("has-error").removeClass("has-success")},lockField:function(e){this.callEvent("removeFieldError",e),e.attr("readonly","readonly").closest(this.settings.input_container).addClass("ajax-loading")},unlockField:function(e){e.removeAttr("readonly").closest(this.settings.input_container).removeClass("ajax-loading")},lockForm:function(){var e=this;e.isLocked=!0,e.$form.find(e.settings.submitBtn).attr("disabled","disabled")},unlockForm:function(){var e=this;e.isLocked=!1,e.$form.find(e.settings.submitBtn).removeAttr("disabled")},afterFormValidate:function(){this.isValid&&this.$form.submit()},scrollToFirstError:function(){var e=this,r=this.filterField(function(r){return r.isValid===!1||r.params.requireGroup&&e.requireGroup[r.params.requireGroup].isValid===!1});r.length&&r[0].$el.first().focus()},reset:function(){var e=this;e.$form[0].reset(),e.fields.forEach(function(r,t,a){e.callEvent("clearField",r.$el),delete r.isValid}),e.callEvent(e.checkImportant()?"unlockForm":"lockForm")}},n=new function(){this._getMessage=function(e,r){if(t[e]&&t[e].length>0){var a=t[e];return r&&r.length>0?(r.forEach(function(e,r){a=a.replace("{"+r+"}",e)}),a):a}if(!t[e])return t},this._setMessage=function(r,a){if(1===arguments.length&&e.isPlainObject(r)&&!e.isEmptyObject(r)){for(var i in r){if("string"!=typeof r[i])return!1;t[i]=r[i]}return!0}return 2===arguments.length&&"string"==typeof r&&"string"==typeof a&&(t[r]=a,!0)},this._getRule=function(e){return e?a[e]||!1:a},this._setRule=function(r,t){if(1===arguments.length&&e.isPlainObject(r)&&!e.isEmptyObject(r)){for(var i in r){if(!e.isFunction(r[i]))return!1;a[i]=r[i]}return!0}return!(2!==arguments.length||"string"!=typeof r||!e.isFunction(t))&&(a[r]=t,!0)},this._getEvent=function(e){return e?i[e]||function(){}:i},this._setEvent=function(r,t){if(1===arguments.length&&e.isPlainObject(r)&&!e.isEmptyObject(r)){for(var a in r){if("string"!=typeof a||!e.isFunction(r[a]))return!1;i[a]=r[a]}return!0}return!(2!==arguments.length||"string"!=typeof r||!e.isFunction(t))&&(i[r]=t,!0)}};window.citrusValidator=function(r,t){if(!r||1!=r.length)throw new Error("citrusValidator: ошибка в аргументе form");var a=this,i=Object.create(a._getRule()),n=Object.create(a._getMessage()),l=Object.create(a._getEvent());a.settings=e.extend({submitBtn:":submit",input_container:".input-container"},t),a.$form=r,a.fields=[],a.requireGroup={},a.isLocked=!1,a.getMessage=function(r,t){var a=this.messages&&this.messages[r]?this.messages[r]:n[r]?n[r]:"";return a.length>0&&"array"===e.type(t)&&t.length>0&&t.forEach(function(e,r){a=a.replace("{"+r+"}",e)}),a},a.setMessage=function(r,t){if(1===arguments.length&&e.isPlainObject(r)&&!e.isEmptyObject(r)){for(var a in r){if("string"!=typeof r[a])return!1;n[a]=r[a]}return!0}return 2===arguments.length&&"string"==typeof r&&"string"==typeof t&&(n[r]=t,!0)},a.getRule=function(e){return e?i[e]||!1:i},a.setRule=function(r,t){if(1===arguments.length&&e.isPlainObject(r)&&!e.isEmptyObject(r)){for(var a in r){if(!e.isFunction(r[a]))return!1;i[a]=r[a]}return!0}return!(2!==arguments.length||"string"!=typeof r||!e.isFunction(t))&&(i[r]=t,!0)},a.getEvent=function(e){return e?l[e]||!1:l},a.setEvent=function(r,t){if(1===arguments.length&&e.isPlainObject(r)&&!e.isEmptyObject(r)){for(var a in r){if("string"!=typeof a||!e.isFunction(r[a]))return!1;l[a]=r[a]}return!0}return!(2!==arguments.length||"string"!=typeof r||!e.isFunction(t))&&(l[r]=t,!0)},a.callEvent=function(e,r,t){if(e)return this.getEvent(e).call(this,r,t),this},a.getField=function(r){return r?a.fields.filter(function(t){return e(t.$el).is(r)}):a.fields},a.filterField=function(r){if(!r||!e.isFunction(r))throw new Error("citrusValidator: ошибка в аргументе функции filterField");return a.fields.filter(r)},a.validateField=function(r,t,i){var n=e.isArray(r)?r:Array(r),t=void 0===t||t,i=i||function(){};n.forEach(function(r){var n=r.arRules.length,l=[],s=function(){r.errors=l,r.params.trigger||r.$el.is(":checkbox, :file, :radio, select")||(r.params.trigger="keyup"),l.length>0?(t&&a.callEvent("addFieldError",r.$el,l),r.$el.trigger("validError",[r]),r.isValid=!1):r.$el.is(":checkbox, :radio")||r.$el.val()?(t&&a.callEvent("removeFieldError",r.$el),r.$el.trigger("validSucess",[r]),r.isValid=!0):(t&&a.callEvent("clearField",r.$el),delete r.isValid),i(r,l)};return r.$el.prop("disabled")?(t&&a.callEvent("clearField",r.$el),delete r.isValid,void s()):n?void r.arRules.forEach(function(t){var i=a.getRule(t);return i&&e.isFunction(i)?(i.call(a,r,function(e,r){r&&(l[l.length]=r),--n||s()}),!0):(console.error("citrusValidator: Нет правила '"+t+"'"),--n||s(),!0)}):(s(),!0)})},a.validateGroup=function(e,r,t){if(e){var t=t||function(){},r="undefined"==typeof r||!!r,i=!1,n=a.filterField(function(r){return r.params.requireGroup==e}),l=[];n.forEach(function(e,r,t){var n=e.params.name||e.$el.attr("name");n&&l.push(n);var s={};s.$el=e.$el,s.arRules=["required"],s.params=[],a.validateField(s,!1,function(e,r){r.length||(i=!0)})});var s=a.getMessage("list_separator");r&&(a.requireGroup[e].error||(a.requireGroup[e].error=[a.getMessage("group",[l.join(s)])]),a.requireGroup[e].isValid=i,a.callEvent(i?"removeGroupError":"addGroupError",e,n)),t(i,n)}},a.validateForm=function(r,t){var t=t||function(){},r="undefined"==typeof r||!!r;a.isValid=!0;var i,n=function(){t(a),r&&a.callEvent("afterFormValidate"),r&&a.callEvent("scrollToFirstError")},l=!0;if(!e.isEmptyObject(a.requireGroup))for(var s in a.requireGroup)i=a.requireGroup[s],i.isValid!==!1?a.validateGroup(s,!0,function(e){e===!1&&(l=!1)}):l=!1;var o=a.fields.length;return o?void a.fields.forEach(function(e){void 0!==e.isValid&&"submit"!==e.params.trigger?(e.isValid||(a.isValid=!1),--o||n()):a.validateField(e,r,function(e){e.isValid||void 0===e.isValid||(a.isValid=!1),--o||n()})}):(n(),!0)},a.checkImportant=function(){var e=a.filterField(function(e){return!!e.params.important}),r=!0;return e.length>0&&e.forEach(function(e){return void 0!==e.isValid?void(e.isValid||(r=!1)):void a.validateField(e,!1,function(e){e.isValid||(r=!1)})}),r},a.addField=function(r,t,i,n){if(!r||"object"!==e.type(r)||!r.length)return void console.error("citrusValidator. v.addField(): $fields не найден");var t=t||[],i=i||{},n=n||{};return r.each(function(r,l){var s=e("radio"==e(this).prop("type")?'[name="'+e(this).prop("name")+'"]':this),o=a.getField(e(l));if(o.length)return o=o[0],o.arRules=e.unique(e.merge(o.arRules,t)),o.params=e.extend(!0,o.params,i),void(o.messages=e.extend(!0,o.messages,n));var u={$el:s,arRules:t,params:i,messages:n};a.fields[a.fields.length]=u,u.params.requireGroup&&!a.requireGroup[u.params.requireGroup]&&(a.requireGroup[u.params.requireGroup]={isValid:void 0,error:""}),s.on("change keyup",function(r){if(13!=r.keyCode){var t=a.getField(e(this))[0]||!1;if(!t)return void console.error("Нет поля в массиве полей v.fields");var i=t.params.trigger||"change";i.indexOf(r.type)<0||(t.params.requireGroup&&a.validateGroup(t.params.requireGroup,!0),a.validateField(t,!0,function(e){e.params.important&&a.callEvent(a.checkImportant()?"unlockForm":"lockForm")}))}})}),r},function(){a.$form.find("[data-valid], [data-valid-params], [data-valid-messages]").each(function(r,t){var i=e(t).data("valid")?e(t).data("valid").split(" "):[],n=e(t).data("valid-params")||{},l=e(t).data("valid-messages")||{};(i||n)&&a.addField(e(t),i,n,l)}),a.$form.on("click",a.settings.submitBtn,function(r){r.preventDefault(),e(this).attr("disabled")||a.validateForm()}),":submit"!==a.settings.submitBtn&&a.$form.on("keypress",function(e){13==e.keyCode&&"textarea"!==e.target.type&&(e.preventDefault(),a.validateForm())}),a.checkImportant()||a.callEvent("lockForm")}()},citrusValidator.prototype=n}(jQuery);
=======
!function(e){"use strict";function t(e){return e.replace(/\(|\)|\s+|-/g,"")}Object.create||(Object.create=function(e){function t(){}return t.prototype=e,new t});var r={required:"Это поле необходимо заполнить.",email:"Пожалуйста, введите корректный адрес электронной почты.",url:"Пожалуйста, введите корректный URL.",date:"Пожалуйста, введите корректную дату.",number:"Пожалуйста, введите число.",confirm_password:"Пароли не совпадают.",maxlength:"Пожалуйста, введите не больше {0} символов.",minlength:"Пожалуйста, введите не меньше {0} символов.",rangelength:"Пожалуйста, введите значение длиной от {0} до {1} символов.",range:"Пожалуйста, введите число от {0} до {1}.",max:"Пожалуйста, введите число, меньшее или равное {0}.",min:"Пожалуйста, введите число, большее или равное {0}.",phone_all:"Пожалуйста, введите корректный номер телефона.",phone:"Пожалуйста, введите корректный номер телефона.",inn:"Пожалуйста, введите корректный ИНН.",inn_u:"Пожалуйста, введите корректный ИНН юр лица.",inn_f:"Пожалуйста, введите корректный ИНН физ лица.",ogrn:"Пожалуйста, введите корректный ОГРН.",kpp:"Пожалуйста, введите корректный КПП.",filetype:"Не верный тип файла. Возможные типы: {0}."},n={file:function(e,t){var r=e.$el;if(!r.val())return t(e),!0;for(var n=!0,i=0;i<r.get(0).files.length;i++){var a=r[0].files[i];if("name"in a){var l=a.name.split(".");l=l[l.length-1].toLocaleLowerCase(),e.params.filetype.indexOf(l)+1||(n=!1)}}var s=n?"":this.getMessage.call(e,"filetype",[e.params.filetype]);t(e,s)},required:function(t,r){var n=t.$el.get(0),i="checkbox"===n.type?n.checked:"radio"===n.type?e('[name="'+n.name+'"]:checked').length:""!==e.trim(n.value),a=i?"":this.getMessage.call(t,"required");r(t,a)},important:function(e,t){t(e)},phone_all:function(e,r){var n=e.$el;if(!n.val())return r(e),!0;var i=t(n.val()),a=i.length>5&&/^((8|\+7)[\- ]?)?(\(?\d{3}\)?[\- ]?)?[\d\- ]{6,10}$/.test(i),l=a?"":this.getMessage.call(e,"phone_all");r(e,l)},phone:function(e,r){var n=e.$el;if(!n.val())return r(e),!0;var i=t(n.val()),a=i.length>10&&/^(8|\+7){1}(\d{10})$/.test(i),l=a?"":this.getMessage.call(e,"phone");r(e,l)},ajax:function(t,r){var n=t.$el;if(!n.val())return r(t),!0;var i=t.params.ajaxUrl;i.length>0&&e.ajax({url:i,type:"POST",dataType:"html",data:{name:n.attr("name"),value:n.val()}}).done(function(e){return e.length>0?void r(t,e):void r(t)}).fail(function(){console.error("error"),r(t)})},email:function(t,r){var n=t.$el;if(!n.val())return r(t),!0;var i=e.trim(n.val()),a=/^(|(([A-Za-z0-9]+_+)|([A-Za-z0-9]+\-+)|([A-Za-z0-9]+\.+)|([A-Za-z0-9]+\++))*[A-Za-z0-9]+@((\w+\-+)|(\w+\.))*\w{1,63}\.[a-zA-Z]{2,6})$/.test(i),l=a?"":this.getMessage.call(t,"email");r(t,l)},number:function(e,t){var r=e.$el;if(!r.val())return t(e),!0;var n=/^(?:-?\d+|-?\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/.test(r.val());if(!n)return void t(e,this.getMessage.call(e,"number"));var i,a,l=+r.val(),s="",o=!1,c=!1;"undefined"!=typeof e.params.min&&""!==e.params.min&&(i=+e.params.min,o=!0),"undefined"!=typeof e.params.max&&""!==e.params.max&&(a=+e.params.max,c=!0),o&&c?(l<i||l>a)&&(s=this.getMessage.call(e,"range",[i,a])):(o&&l<i&&(s=this.getMessage.call(e,"min",[i])),c&&l>a&&(s=this.getMessage.call(e,"max",[a]))),t(e,s)},length:function(e,t){var r=e.$el;if(!r.val())return t(e),!0;var n=e.params.minlength,i=e.params.maxlength,a=r.val().length,l=!1;"undefined"!=typeof n&&"undefined"!=typeof i?(a>i||a<n)&&(l=this.getMessage.call(e,"rangelength",[n,i])):"undefined"!=typeof n?a<n&&(l=this.getMessage.call(e,"minlength",[n])):"undefined"!=typeof i&&a>i&&(l=this.getMessage.call(e,"maxlength",[i])),t(e,l)},main_password:function(t,r){var n=t.$el,i=this.filterField(function(t){return e.inArray("confirm_password",t.arRules)+1})[0];i.$el.val()&&n.val()&&this.validateField(i),r(t)},confirm_password:function(t,r){var n=t.$el;if(!n.val())return r(t),!0;var i=this.filterField(function(t){return e.inArray("main_password",t.arRules)+1})[0],a=n.val()===i.$el.val(),l=a?"":this.getMessage.call(t,"confirm_password");r(t,l)},url:function(e,t){var r=e.$el;if(!r.val())return t(e),!0;var n=/^(?:(?:(?:https?|ftp):)?\/\/)(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})).?)(?::\d{2,5})?(?:[\/?#]\S*)?$/i.test(r.val()),i=n?"":this.getMessage.call(e,"url");t(e,i)},inn:function(e,t){var r=e.$el;if(!r.val())return t(e),!0;var n=r.val(),i=!0;if(n.match(/\D/))i=!1;else{if(12!=n.length&&10!=n.length&&(i=!1),10==n.length){var a=String((2*n[0]+4*n[1]+10*n[2]+3*n[3]+5*n[4]+9*n[5]+4*n[6]+6*n[7]+8*n[8])%11%10);i=n[9]==a}if(12==n.length){var l=String((7*n[0]+2*n[1]+4*n[2]+10*n[3]+3*n[4]+5*n[5]+9*n[6]+4*n[7]+6*n[8]+8*n[9])%11%10),s=String((3*n[0]+7*n[1]+2*n[2]+4*n[3]+10*n[4]+3*n[5]+5*n[6]+9*n[7]+4*n[8]+6*n[9]+8*n[10])%11%10);i=n[10]==l&&n[11]==s}}var o=i?"":this.getMessage.call(e,"inn");t(e,o)},inn_u:function(e,t){var r=e.$el;if(!r.val())return t(e),!0;var n=r.val(),i=!0;n.match(/\D/)&&(i=!1),10!=n.length&&(i=!1);var a=String((2*n[0]+4*n[1]+10*n[2]+3*n[3]+5*n[4]+9*n[5]+4*n[6]+6*n[7]+8*n[8])%11%10);i=n[9]==a;var l=i?"":this.getMessage.call(e,"inn_u");t(e,l)},inn_f:function(e,t){var r=e.$el;if(!r.val())return t(e),!0;var n=r.val(),i=!0;n.match(/\D/)&&(i=!1),i=12==n.length&&n[10]==(7*n[0]+2*n[1]+4*n[2]+10*n[3]+3*n[4]+5*n[5]+9*n[6]+4*n[7]+6*n[8]+8*n[9])%11%10&&n[11]==(3*n[0]+7*n[1]+2*n[2]+4*n[3]+10*n[4]+3*n[5]+5*n[6]+9*n[7]+4*n[8]+6*n[9]+8*n[10])%11%10;var a=i?"":this.getMessage.call(e,"inn_f");t(e,a)},ogrn:function(e,t){var r=e.$el;if(!r.val())return t(e),!0;var n=r.val(),i=!0;i=13==n.length&&n.slice(-1)==(n.slice(0,-1)%11+"").slice(-1)||15==n.length&&n.slice(-1)==(n.slice(0,-1)%13+"").slice(-1);var a=i?"":this.getMessage.call(e,"ogrn");t(e,a)},kpp:function(e,t){var r=e.$el;if(!r.val())return t(e),!0;var n=r.val(),i=!0;n.match(/\D/)&&(i=!1),n.match(/([0-9]{1}[1-9]{1}|[1-9]{1}[0-9]{1})([0-9]{2})([0-9A-F]{2})([0-9]{3})/)||(i=!1);var a=i?"":this.getMessage.call(e,"kpp");t(e,a)}},i={addFieldError:function(e,t){var r=e.parents(".input-container");r.addClass("has-error").removeClass("has-success");var n=t.join("<br>"),i=r.find(".error.help-block");i.length>0?i.html(n):r.append('<div class="error help-block">'+n+"</div>")},removeFieldError:function(e){e.parents(".input-container").removeClass("has-error").addClass("has-success")},clearField:function(e){e.parents(".input-container").removeClass("has-error").removeClass("has-success")},lockField:function(e){this.callEvent("removeFieldError",e),e.attr("readonly","readonly").closest(".input-container").addClass("ajax-loading")},unlockField:function(e){e.removeAttr("readonly").closest(".input-container").removeClass("ajax-loading")},lockForm:function(){var e=this;e.isLocked=!0,e.$form.find(e.settings.submitBtn).attr("disabled","disabled")},unlockForm:function(){var e=this;e.isLocked=!1,e.$form.find(e.settings.submitBtn).removeAttr("disabled")},afterFormValidate:function(){this.isValid&&this.$form.submit()},scrollToFirstError:function(){var e=this.filterField(function(e){return e.isValid===!1});e.length&&e[0].$el.first().focus()},reset:function(){var e=this;e.$form[0].reset(),e.fields.forEach(function(t,r,n){e.callEvent("clearField",t.$el),delete t.isValid}),e.callEvent(e.checkImportant()?"unlockForm":"lockForm")}},a=new function(){this._getMessage=function(e,t){if(r[e]&&r[e].length>0){var n=r[e];return t&&t.length>0?(t.forEach(function(e,t){n=n.replace("{"+t+"}",e)}),n):n}if(!r[e])return r},this._setMessage=function(t,n){if(1===arguments.length&&e.isPlainObject(t)&&!e.isEmptyObject(t)){for(var i in t){if("string"!=typeof t[i])return!1;r[i]=t[i]}return!0}return 2===arguments.length&&"string"==typeof t&&"string"==typeof n&&(r[t]=n,!0)},this._getRule=function(e){return e?n[e]||!1:n},this._setRule=function(t,r){if(1===arguments.length&&e.isPlainObject(t)&&!e.isEmptyObject(t)){for(var i in t){if(!e.isFunction(t[i]))return!1;n[i]=t[i]}return!0}return!(2!==arguments.length||"string"!=typeof t||!e.isFunction(r))&&(n[t]=r,!0)},this._getEvent=function(e){return e?i[e]||function(){}:i},this._setEvent=function(t,r){if(1===arguments.length&&e.isPlainObject(t)&&!e.isEmptyObject(t)){for(var n in t){if("string"!=typeof n||!e.isFunction(t[n]))return!1;i[n]=t[n]}return!0}return!(2!==arguments.length||"string"!=typeof t||!e.isFunction(r))&&(i[t]=r,!0)}};window.citrusValidator=function(t,r){if(!t||1!=t.length)throw new Error("citrusValidator: ошибка в аргументе form");var n=this,i=Object.create(n._getRule()),a=Object.create(n._getMessage()),l=Object.create(n._getEvent());n.settings=e.extend({submitBtn:":submit"},r),n.$form=t,n.fields=Array(),n.isLocked=!1,n.getMessage=function(t,r){var n=this.messages&&this.messages[t]?this.messages[t]:a[t]?a[t]:"";return n.length>0&&"array"===e.type(r)&&r.length>0&&r.forEach(function(e,t){n=n.replace("{"+t+"}",e)}),n},n.setMessage=function(t,r){if(1===arguments.length&&e.isPlainObject(t)&&!e.isEmptyObject(t)){for(var n in t){if("string"!=typeof t[n])return!1;a[n]=t[n]}return!0}return 2===arguments.length&&"string"==typeof t&&"string"==typeof r&&(a[t]=r,!0)},n.getRule=function(e){return e?i[e]||!1:i},n.setRule=function(t,r){if(1===arguments.length&&e.isPlainObject(t)&&!e.isEmptyObject(t)){for(var n in t){if(!e.isFunction(t[n]))return!1;i[n]=t[n]}return!0}return!(2!==arguments.length||"string"!=typeof t||!e.isFunction(r))&&(i[t]=r,!0)},n.getEvent=function(e){return e?l[e]||!1:l},n.setEvent=function(t,r){if(1===arguments.length&&e.isPlainObject(t)&&!e.isEmptyObject(t)){for(var n in t){if("string"!=typeof n||!e.isFunction(t[n]))return!1;l[n]=t[n]}return!0}return!(2!==arguments.length||"string"!=typeof t||!e.isFunction(r))&&(l[t]=r,!0)},n.callEvent=function(e,t,r){if(e)return this.getEvent(e).call(this,t,r),this},n.getField=function(t){return t?n.fields.filter(function(r){return e(r.$el).is(t)}):n.fields},n.filterField=function(t){if(!t||!e.isFunction(t))throw new Error("citrusValidator: ошибка в аргументе функции filterField");return n.fields.filter(t)},n.validateField=function(t,r,i){var t=e.isArray(t)?t:Array(t),r=void 0===r||r,i=i||function(){};t.forEach(function(t){function a(){t.params.lockOnValid&&n.callEvent("unlockField",t.$el),t.errors=s,t.params.trigger||t.$el.is(":checkbox, :file, :radio, select")||(t.params.trigger="keyup"),s.length>0?(r&&n.callEvent("addFieldError",t.$el,s),t.$el.trigger("validError",[t]),t.isValid=!1):t.$el.is(":checkbox, :radio")||t.$el.val()?(r&&n.callEvent("removeFieldError",t.$el),t.$el.trigger("validSucess",[t]),t.isValid=!0):(r&&n.callEvent("clearField",t.$el),delete t.isValid),i(t,s)}t.params.lockOnValid&&n.callEvent("lockField",t.$el);var l=t.arRules.length,s=Array();return t.$el.prop("disabled")?(r&&n.callEvent("clearField",t.$el),delete t.isValid,void a()):l?void t.arRules.forEach(function(r){var i=n.getRule(r);return i&&e.isFunction(i)?(i.call(n,t,function(e,t){t&&(s[s.length]=t),--l||a()}),!0):(console.log("citrusValidator: Нет правила '"+r+"'"),--l||a(),!0)}):(a(),!0)})},n.validateForm=function(e,t){var t=t||function(){},e="undefined"==typeof e||!!e,r=n.fields.length;return n.isValid=!0,r?void n.fields.forEach(function(i){void 0!==i.isValid&&"submit"!==i.params.trigger?(i.isValid||(n.isValid=!1),--r||(t(n),e&&n.callEvent("afterFormValidate"),e&&n.callEvent("scrollToFirstError"))):n.validateField(i,e,function(i){i.isValid||void 0===i.isValid||(n.isValid=!1),--r||(t(n),e&&n.callEvent("afterFormValidate"),e&&n.callEvent("scrollToFirstError"))})}):(t(n),e&&n.callEvent("afterFormValidate"),!0)},n.checkImportant=function(){var e=n.filterField(function(e){return!!e.params.important}),t=!0;return e.length>0&&e.forEach(function(e){return void 0!==e.isValid?void(e.isValid||(t=!1)):void n.validateField(e,!1,function(e){e.isValid||(t=!1)})}),t},n.addField=function(t,r,i,a){if(!t||"object"!==e.type(t)||!t.length)throw new Error("citrusValidator: ошибка в аргументе $fields");var r=r||[],i=i||{},a=a||{};return t.each(function(t,l){var s=e("radio"==e(this).prop("type")?'[name="'+e(this).prop("name")+'"]':this),o=n.getField(e(l));return o.length?(o=o[0],o.arRules=e.unique(e.merge(o.arRules,r)),o.params=e.extend(!0,o.params,i),void(o.messages=e.extend(!0,o.messages,a))):(n.fields[n.fields.length]={$el:s,arRules:r,params:i,messages:a},s.on("change keyup",function(t){if(13!=t.keyCode){var r=n.getField(e(this))[0]||!1;if(!r)return void console.error("Нет поля в массиве полей v.fields");var i=r.params.trigger||"change";if(!(i.indexOf(t.type)<0)){var a=n.getField(e(this));n.validateField(a,!0,function(e){e.params.important&&n.callEvent(n.checkImportant()?"unlockForm":"lockForm")})}}}),void s.on("validate",function(){var t=n.getField(e(this));n.validateField(t,!0,function(e){e.params.important&&n.callEvent(n.checkImportant()?"unlockForm":"lockForm")})}))}),t},function(){n.$form.find("[data-valid], [data-valid-params], [data-valid-messages]").each(function(t,r){var i=e(r).data("valid")?e(r).data("valid").split(" "):[],a=e(r).data("valid-params")||{},l=e(r).data("valid-messages")||{};!i.length&&e.isEmptyObject(a)&&e.isEmptyObject(l)||n.addField(e(r),i,a,l)}),n.$form.on("click",n.settings.submitBtn,function(t){t.preventDefault(),e(this).attr("disabled")||n.validateForm()}),":submit"!==n.settings.submitBtn&&n.$form.on("keypress",function(e){13==e.keyCode&&"textarea"!==e.target.type&&(e.preventDefault(),n.validateForm())}),n.checkImportant()||n.callEvent("lockForm")}()},citrusValidator.prototype=a}(jQuery);
>>>>>>> origin/master
